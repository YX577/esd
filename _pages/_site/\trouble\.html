<h1 id="trouble-shooting">Trouble shooting</h1>
<p>The ‘esd’ comes as it is and there is no guarantee that it’s free from bugs or incorrect coding. The user therefore must make sure that the functions work as expected through thorough testing.
Any tool like this should never be used blindly. Neither is there any guarantee that the code will work flawlessly. The open-source nature, however, means that the problems can be diagnosed
or fixed by anyone with insight and programming skills. Here we try to make potential trouble shooting easier.</p>

<h2 id="general">General</h2>
<p>In case of error messages, it may be wise to check all the attributes of the data object. The way to proceed is to activate the ‘verbose’ argument if it is included in the function options,
and repeat the analysis with the sample data provided by ‘esd’. The objects can be assigned new attributes through the ‘attr’ command. Alternatively, the source code of the function can
be modified locally, by typing the name of the function without ‘()’ and copied into a local file (Example 7.1). The code in the local file can then be modified and when it is called override
the original ‘esd’ version.</p>

<p>Example 7.1.</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get the source code in ’myeof.R’ R script file</span><span class="w">
</span><span class="n">dput</span><span class="p">(</span><span class="n">EOF.default</span><span class="p">,</span><span class="n">file</span><span class="o">=</span><span class="s2">"myeof.R"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Modify this code, but keep the same function name by adding ’EOF.default’ at the top of</span><span class="w">
</span><span class="c1"># the file.</span><span class="w">
</span><span class="c1"># Source the new code as</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"myeof.R"</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="n">environment</span><span class="p">())</span><span class="w">
</span><span class="c1"># now the call "EOF()" will use the modified version.</span><span class="w">
</span></code></pre></div></div>
<p>Debugging can be done by inserting ‘browser()’ inside the function code.</p>

<h2 id="functions-annual-and-aggregate">Functions ‘annual’ and ‘aggregate’</h2>
<p>Missing data (‘NA’) can be a problem in the analysis and the downscaling of local temperature
and precipitation. One example of an error is:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">annual</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">Error</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">aggregate.data.frame</span><span class="p">(</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w">
</span><span class="n">no</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">aggregate</span><span class="w">
</span></code></pre></div></div>

<p>However, if the number of missing data is small compared to the sample size, they may not have a large effect on the calibration of downscaling models or the aggregated statistics. For the
temperature, a fix can be to use interpolation to fill in the missing values as in Example 7.2. For daily precipitation, a better option can be to replace missing data with zero.</p>

<p>Example 7.2.</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Retrieve 2m air temperature at Ferder Fyr weather station</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">ferder</span><span class="p">)</span><span class="w">
</span><span class="c1"># Extract the coredata</span><span class="w">
</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">coredata</span><span class="p">(</span><span class="n">ferder</span><span class="p">)</span><span class="w">
</span><span class="c1"># identify the missing days in the record</span><span class="w">
</span><span class="n">md</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">ferder</span><span class="p">)</span><span class="w">
</span><span class="c1"># Compute the climatology</span><span class="w">
</span><span class="n">clim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.climatology</span><span class="p">(</span><span class="n">ferder</span><span class="p">)</span><span class="w">
</span><span class="c1"># Replace the missing values with the climatology as approximations</span><span class="w">
</span><span class="n">ferder</span><span class="p">[</span><span class="n">md</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">coredata</span><span class="p">(</span><span class="n">clim</span><span class="p">)[</span><span class="n">as.POSIXlt</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="n">ferder</span><span class="p">)[</span><span class="n">md</span><span class="p">])</span><span class="o">$</span><span class="n">yday</span><span class="m">+1</span><span class="p">]</span><span class="w">
</span><span class="c1"># Note that as.POSIXlt()$yday function returns the day in the year</span><span class="w">
</span></code></pre></div></div>

<h2 id="dsensemble">DSensemble</h2>
<p>The method ‘DSensemble’ uses ‘try’ to avoid that the process stops due to errors when looping through the ensemble of GCM results. However, it cannot recover from errors in For-
tran or C-based external modules, such as those based on external libraries. For instance, the following errors have been encountered:
Error in La.svd(x, nu, nv) : error code 1 from Lapack routine ’dgesdd’ and/or Error in x[rep(1:NROW(x), length.out = length(index)), , drop = FALSE] : subscript out of bounds
The problem is that the data matrix to which an SVD is applied is close to singular. One work-around fix is to use a different domain selection (e.g. set ‘lon’ and ‘lat’ arguments to
new values). Another way to get around this problem is to use the argument ‘select’ to skip a particular model with the problem.</p>
<h3 id="poor-fit">Poor fit</h3>
<p>Sometimes a sub-selection of the predictand can improve the calibration of the downscaling model, especially if part of the data (older) has a lower quality than more recent measurements.
One way to examine the data for quality can be to plot the time series of the annual wet-day mean and frequency for precipitation.</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">annual</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">FUN</span><span class="o">=</span><span class="err">’</span><span class="n">wetfreq</span><span class="err">’</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">annual</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">FUN</span><span class="o">=</span><span class="err">’</span><span class="n">wetmean</span><span class="err">’</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<h3 id="other-error-messages">Other error messages</h3>
<p>There may occasionally be problems associated with different types of time stamps, e.g. when combining daily, monthly, seasonal, or annual data. The time index for annual data is a numeric</p>
<ul>
  <li>the year, and some of the methods handling the date may fail for annual data. E.g: Error in prettyNum(.Internal(format(x, trim, digits, nsmall, width, 3L,: invalid ’trim’ argument</li>
</ul>

<p>A couple of solutions are:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">index</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="n">year</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="err">’</span><span class="m">01-01</span><span class="err">’</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="err">’</span><span class="o">-</span><span class="err">’</span><span class="p">))</span><span class="w">
</span><span class="c1">## or</span><span class="w">
</span><span class="n">index</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<h2 id="validate">Validate</h2>
<p>The ‘esd’ package also has a method ‘validate’ which provides a simple test statistics describing how well the results match the expectations. The null hypothesis depends on the
type of object.</p>
