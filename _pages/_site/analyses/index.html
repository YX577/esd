<h1 class="no_toc" id="analyses--diagnostics">Analyses &amp; Diagnostics</h1>

<details open="">
  <summary class="text-delta">
    Table of contents
  </summary>
<ol id="markdown-toc">
  <li><a href="#empirical-orthogonal-functions" id="markdown-toc-empirical-orthogonal-functions">Empirical Orthogonal Functions</a></li>
  <li><a href="#principal-component-analysis" id="markdown-toc-principal-component-analysis">Principal Component Analysis</a></li>
  <li><a href="#canonical-correlation-analysis" id="markdown-toc-canonical-correlation-analysis">Canonical Correlation Analysis</a></li>
  <li><a href="#other-types-of-analysis" id="markdown-toc-other-types-of-analysis">Other types of analysis</a></li>
  <li><a href="#predict--project" id="markdown-toc-predict--project">Predict &amp; project</a></li>
</ol>

</details>

<h2 id="empirical-orthogonal-functions">Empirical Orthogonal Functions</h2>
<p>Empirical orthogonal functions (EOFs; Lorenz (1956)) provide a handy framework for multivariate data analysis. Here EOFs refer to a class of data objects, however, in a more general
context, EOFs refer to the spatial coherent structures which maximise the variance, whereas the principal components (PCs) refer to time series describing the degree of their presence at any
time. The eigenvalues refer to the variance of each EOF mode.
In ‘esd’, the EOFs are estimated using a singular value decomposition (SVD) (Press et al., 1989a; Strang, 1988):</p>

<p>X = U ΛV T , (2)</p>

<p>where X is a matrix of data with two dimensions (space, time), U hold the EOF patterns, Λ is a diagonal matrix with the eigenvalues, and V contains the PCs. The EOFs are used to
extract the essence of the information embedded in the data, taking advantage of redundancy and emphasising the most prominent characteristics. Example 4.1 shows how the EOFs can be
estimated and visualised in ‘esd’.
The EOFs are used as input to other analysis, such as downscaling (<code class="language-plaintext highlighter-rouge">DS</code>) and canonical correlation analysis (<code class="language-plaintext highlighter-rouge">CCA</code>). It is also possible to recover the original data from EOFs through
<code class="language-plaintext highlighter-rouge">eof2field</code>, however, the number of EOFs are usually truncated, and only the most prominent features are recovered. The function <code class="language-plaintext highlighter-rouge">eof2field</code> can be used to filter the data in terms of
removing small scale and noisy features.
The EOFs can provide an indication of some of the most prominent phenomena in the climate system, such as the annual cycle, the El Ni˜no Southern Oscillation, and the Arctic Oscillation.</p>

<h2 id="principal-component-analysis">Principal Component Analysis</h2>
<p>The method called PCA - principal component analysis - is similar to EOF, but is designed for groups of stations rather than gridded fields (Example 4.2). The PCA can also be used
to represent data on an irregular grid (such as rotated fields from regional climate models). It is possible to grid the spatial modes of the PCA onto a regular grid, and hence convert
the pca class into a eof class (the gridding is currently not performed in esd, but could be done using optimal interpolation, or kriging taking geographical features into account (Benestad
et al., 2012)). Whereas EOF weights each grid box with its grid box area, PCA does not apply any weighting to the different series (which may imply that correlated variability from nearby
stations is emphasised by the PCA).</p>

<p>PCAs are useful for investigating large-scale dependency, as the leading mode will pick up patterns with coherent variations across the stations. They are also used in CCA and identifying
stations with suspect data.</p>

<h2 id="canonical-correlation-analysis">Canonical Correlation Analysis</h2>
<p>Canonical correlation analysis (CCA) can be used to explore dependencies between different data sets (Example 4.3). It is a useful tool for investigating suitable predictors for downscaling
or identifying tele-connections. Sometimes it can provide some indications of suspect station data.
The computation of the CCA in ‘esd’ is based on the method by Barnett-Preisendorfer (Barnett and Preisendorfer , 1987; Wilks, 1995). The inputs are either an ‘pca’ or ‘eof’ class.</p>

<h2 id="other-types-of-analysis">Other types of analysis</h2>
<p>Methods such as singular spectrum analysis (<code class="language-plaintext highlighter-rouge">SSA</code>) and ‘coherence’ have been adapted from the ‘clim.pact’ package, but have not been elaborated and tested yet for the ‘esd’
objects. There is also a set of low-pass filters such as <code class="language-plaintext highlighter-rouge">filt</code>. Other type of analysis can be included such as performing a multivariate regression analysis (MVR) and using eof to do the
downscaling.</p>

<h2 id="predict--project">Predict &amp; project</h2>
<p>In ‘esd’, the S3 method ‘predict’ is extended to the ‘ds’ class and may be extended to CCA (<code class="language-plaintext highlighter-rouge">cca</code>) and singular spectrum analysis (<code class="language-plaintext highlighter-rouge">ssa</code>) in the future. The call <code class="language-plaintext highlighter-rouge">predict</code> will
return the downscaled results for the calibration method by default, but can also be used to return a projection if the downscaling was based on a common EOF or a prediction based on a
new EOF. The method ‘project’ is a more specific version of ‘predict’ that returns results from a projection (Example 4.4). The downscaled results from a projection are also contained
in the <code class="language-plaintext highlighter-rouge">ds</code> object.</p>

<p>Example 4.1.</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load 2m air temperature from NCEP reanalysis</span><span class="w">
</span><span class="n">t2m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t2m.NCEP</span><span class="p">()</span><span class="w">
</span><span class="c1"># Compute the EOFs</span><span class="w">
</span><span class="n">eof</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">EOF</span><span class="p">(</span><span class="n">t2m</span><span class="p">)</span><span class="w">
</span><span class="c1"># Plot the eof</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">eof</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Figure 16: Plotting EOF analysis based on NCEP 2 meter surface temperature consisting of a map of the averaged field (top left), the explained variance by each EOF, and the principal
component of the first leading EOF which accounts for almost 88% of the total variability.</p>

<p>Example 4.2.</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Retrieve NACD temperature weather stations</span><span class="w">
</span><span class="n">nacd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">station</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="err">’</span><span class="n">nacd</span><span class="err">’</span><span class="p">,</span><span class="n">param</span><span class="o">=</span><span class="err">’</span><span class="n">t2m</span><span class="err">’</span><span class="p">)</span><span class="w">
</span><span class="c1"># Compute the annual mean values</span><span class="w">
</span><span class="n">NACD</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">annual</span><span class="p">(</span><span class="n">nacd</span><span class="p">)</span><span class="w">
</span><span class="c1"># Compute the number of valid data points for each station</span><span class="w">
</span><span class="n">ok</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">NACD</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="n">FUN</span><span class="o">=</span><span class="err">’</span><span class="n">nv</span><span class="err">’</span><span class="p">)</span><span class="w">
</span><span class="c1"># Retain only the stations with minimum of 100 valid data points</span><span class="w">
</span><span class="n">NACD</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">NACD</span><span class="p">,</span><span class="n">is</span><span class="o">=</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">ok</span><span class="p">))[</span><span class="n">ok</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">100</span><span class="p">])</span><span class="w">
</span><span class="c1"># Do the PCA</span><span class="w">
</span><span class="n">pca</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">PCA</span><span class="p">(</span><span class="n">NACD</span><span class="p">)</span><span class="w">
</span><span class="c1"># Visualise the results</span><span class="w">
</span><span class="n">vis</span><span class="p">(</span><span class="n">pca</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Figure 17: Summary of maps and plot showing the a) climatology, EOF 1 to 3, and the first three PCs computed from monthly surface temperature provided by the NACD dataset. The
climatological map shows a clear south to north temperature gradient. The first leading EOF accounts for 72.83% of the total spatial variability followed by 9.03.31% and 6.38% for the second
and third EOFs. The PCs do not show a significant trend.</p>

<p>Example 4.3.</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get NACD stations</span><span class="w">
</span><span class="n">nacd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">station</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="err">’</span><span class="n">nacd</span><span class="err">’</span><span class="p">,</span><span class="n">param</span><span class="o">=</span><span class="err">’</span><span class="n">t2m</span><span class="err">’</span><span class="p">)</span><span class="w">
</span><span class="c1"># Aggregate to annual values</span><span class="w">
</span><span class="n">NACD</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">annual</span><span class="p">(</span><span class="n">nacd</span><span class="p">)</span><span class="w">
</span><span class="c1"># Check for missing values</span><span class="w">
</span><span class="n">ok</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">NACD</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="n">FUN</span><span class="o">=</span><span class="err">’</span><span class="n">nv</span><span class="err">’</span><span class="p">)</span><span class="w">
</span><span class="c1"># Subset NACD stations with more than 100 data points</span><span class="w">
</span><span class="n">NACD</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">NACD</span><span class="p">,</span><span class="n">is</span><span class="o">=</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">ok</span><span class="p">))[</span><span class="n">ok</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">100</span><span class="p">])</span><span class="w">
</span><span class="c1"># Compute the PCAs</span><span class="w">
</span><span class="n">pca</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">PCA</span><span class="p">(</span><span class="n">NACD</span><span class="p">)</span><span class="w">
</span><span class="c1"># Retrieve slp field and aggregate to annual values</span><span class="w">
</span><span class="n">slp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">annual</span><span class="p">(</span><span class="n">slp.DNMI</span><span class="p">())</span><span class="w">
</span><span class="c1"># compute EOF of slp</span><span class="w">
</span><span class="n">eof</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">EOF</span><span class="p">(</span><span class="n">slp</span><span class="p">)</span><span class="w">
</span><span class="c1"># compute CCA on both pca and eof</span><span class="w">
</span><span class="n">cca</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">CCA</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span><span class="n">eof</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">cca</span><span class="p">)</span><span class="w">
</span><span class="n">slp</span><span class="p">(</span><span class="n">hPa</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Figure 18: Plot of CCA analysis based on PCs of annual mean surface temperature and EOF
of annual mean Sea level pressure from DNMI.</p>

<p>Example 4.4. # Sample temperature data for Oslo</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">(</span><span class="n">Oslo</span><span class="p">)</span><span class="w">
</span><span class="c1"># Get ERA40 2m air temperature</span><span class="w">
</span><span class="n">t2m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t2m.ERA40</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">20</span><span class="p">),</span><span class="n">lat</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="m">70</span><span class="p">))</span><span class="w">
</span><span class="c1"># Get NorESM.M 2m air temperature</span><span class="w">
</span><span class="n">T2m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t2m.NorESM.M</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">20</span><span class="p">),</span><span class="n">lat</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="m">70</span><span class="p">)))</span><span class="w">
</span><span class="c1"># Combine the two fields</span><span class="w">
</span><span class="n">comb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">combine</span><span class="p">(</span><span class="n">t2m</span><span class="p">,</span><span class="n">T2m</span><span class="p">)</span><span class="w">
</span><span class="c1"># Compute the common eof t2m</span><span class="w">
</span><span class="n">ceof</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">EOF</span><span class="p">(</span><span class="n">comb</span><span class="p">)</span><span class="w">
</span><span class="c1"># Do the downscaling of y based on X</span><span class="w">
</span><span class="n">ds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">DS</span><span class="p">(</span><span class="n">Oslo</span><span class="p">,</span><span class="n">ceof</span><span class="p">)</span><span class="w">
</span><span class="c1"># Subset the calibration</span><span class="w">
</span><span class="n">z.calibration</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">EOF</span><span class="p">(</span><span class="n">t2m</span><span class="p">))</span><span class="w">
</span><span class="c1"># Extract projected data sets</span><span class="w">
</span><span class="n">z.projection</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">project.ds</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span><span class="w">

</span><span class="c1">## Trajectory objects</span><span class="w">
</span><span class="n">The</span><span class="w"> </span><span class="n">esd</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="n">includes</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">statistical</span><span class="w"> </span><span class="n">analysis</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">visualisation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">trajectory</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">e.g.</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">paths</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">extra</span><span class="o">-</span><span class="n">tropical</span><span class="w"> </span><span class="n">cyclones</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">ice</span><span class="w"> </span><span class="n">bergs.</span><span class="w"> </span><span class="n">Many</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="n">tools</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">methods</span><span class="w">
</span><span class="n">are</span><span class="w"> </span><span class="n">applicable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">‘</span><span class="n">trajectory</span><span class="err">’</span><span class="w"> </span><span class="n">objects</span><span class="p">,</span><span class="w"> </span><span class="n">e.</span><span class="w"> </span><span class="n">g.</span><span class="p">,</span><span class="w"> </span><span class="n">limiting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">`subset`</span><span class="p">,</span><span class="w"> </span><span class="n">visualising</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">trajectories</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">`map`</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">`plot`</span><span class="p">,</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">well</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">analysis</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">downscaling</span><span class="w">
</span><span class="p">(</span><span class="n">`PCA`</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">`DS`</span><span class="p">)</span><span class="n">.</span><span class="w">
</span><span class="n">The</span><span class="w"> </span><span class="n">trajectory</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">designed</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">analysis</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">storm</span><span class="w"> </span><span class="n">tracks</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">mind</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">particular</span><span class="w"> </span><span class="n">cyclone</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">produced</span><span class="w"> </span><span class="n">under</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">IMILAST</span><span class="w"> </span><span class="p">(</span><span class="n">Inter</span><span class="o">-</span><span class="n">comparison</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="n">latitude</span><span class="w">
</span><span class="n">storm</span><span class="w"> </span><span class="n">diagnostics</span><span class="p">)</span><span class="w"> </span><span class="n">project</span><span class="w"> </span><span class="p">(</span><span class="n">Neu</span><span class="w"> </span><span class="n">et</span><span class="w"> </span><span class="n">al.</span><span class="p">,</span><span class="w"> </span><span class="m">2012</span><span class="p">)</span><span class="n">.</span><span class="w"> </span><span class="n">Trajectory</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">follow</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">IMILAST</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">imported</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="err">‘</span><span class="n">read.imilast</span><span class="err">’</span><span class="n">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">IMILAST</span><span class="w"> </span><span class="n">data</span><span class="w">
</span><span class="n">must</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">transformed</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">trajectory</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="err">‘</span><span class="n">trajectory</span><span class="err">’</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">esd</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">applied.</span><span class="w">

</span><span class="err">```</span><span class="n">R</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.imilast</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">pathtofile</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">trajectory</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The function ‘trajectory’ transforms a data frame containing spatio-temporal information about trajectories of variable length to a matrix with the trajectories interpolated to the
same length (by default 10). The input to ‘trajectory’ must for every time step include a ‘Trajectory’ id number, as well as geographical (<code class="language-plaintext highlighter-rouge">lat</code><em>itude, <code class="language-plaintext highlighter-rouge">lon</code></em>gitude) and temporal
(<code class="language-plaintext highlighter-rouge">year</code>, <code class="language-plaintext highlighter-rouge">month</code>, <code class="language-plaintext highlighter-rouge">day</code>, and <code class="language-plaintext highlighter-rouge">time</code>) information, and optionally a quality flag (<code class="language-plaintext highlighter-rouge">Code99</code>). Other parameters describing the evolution of the trajectory may also be included and will then be
interpolated and passed on to the ‘trajectory’ object. Meta data can be entered as arguments to the ‘trajectory’ function, e.g. a description of the parameter (‘param’ or ‘longname’), the
source of the data (<code class="language-plaintext highlighter-rouge">src</code>), or references to a paper, website or method (<code class="language-plaintext highlighter-rouge">reference</code>, <code class="language-plaintext highlighter-rouge">URL</code>, <code class="language-plaintext highlighter-rouge">method</code>). A sample file, <code class="language-plaintext highlighter-rouge">imilast.M03</code>, containing trajectories of deep cyclones in the North Atlantic
region comes with esd and is provided in its examples. These storm paths were obtained by cyclone identification in a gridded data set (ERAinterim, 1.5◦ resolution) using a calculus based
cyclone identification (CCI) algorithm (Benestad and Chen) (method 3 of IMILAST). In the future, ‘esd’ will be extended to cyclone identification and tracking using this CCI method.
Example 4.5 demonstrates how to select a subset of trajectories and plot the annual storm count using the function <code class="language-plaintext highlighter-rouge">plot.trajectory()</code>. The spatial extent of the trajectories can be
plotted either as individual tracks on a map by the function <code class="language-plaintext highlighter-rouge">map.trajectory()</code>, or as the number density (unit: year−1 1000km−2) by <code class="language-plaintext highlighter-rouge">map.density.trajectory</code> (Example 4.6). Principal
component analysis of <code class="language-plaintext highlighter-rouge">trajectory</code> objects is by default applied to the longitude and latitude displacement with regards to the starting point of the individual trajectories (Example 4.7).</p>

<p>Example 4.5.</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Sample trajectory object</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">imilast.M03</span><span class="p">)</span><span class="w">
</span><span class="c1"># Select storm trajectories in region 40-60N</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">imilast.M03</span><span class="p">,</span><span class="nf">is=list</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">40</span><span class="p">,</span><span class="m">60</span><span class="p">)))</span><span class="w">
</span><span class="c1"># Select winter storms</span><span class="w">
</span><span class="n">djf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">it</span><span class="o">=</span><span class="err">’</span><span class="n">djf</span><span class="err">’</span><span class="p">)</span><span class="w">
</span><span class="c1"># Calculate the seasonal storm count</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">count.trajectory</span><span class="p">(</span><span class="n">djf</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="err">’</span><span class="n">year</span><span class="err">’</span><span class="p">)</span><span class="w">
</span><span class="c1"># Plot the annual storm count</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">new</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">60</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="err">’</span><span class="n">black</span><span class="err">’</span><span class="p">)</span><span class="w">
</span><span class="c1"># Add storm count for winter (djf)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="err">’</span><span class="n">blue</span><span class="err">’</span><span class="p">,</span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="err">’</span><span class="n">topright</span><span class="err">’</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="err">’</span><span class="n">all</span><span class="w"> </span><span class="n">year</span><span class="err">’</span><span class="p">,</span><span class="err">’</span><span class="n">djf</span><span class="err">’</span><span class="p">),</span><span class="n">lty</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="p">(</span><span class="err">’</span><span class="n">black</span><span class="err">’</span><span class="p">,</span><span class="err">’</span><span class="n">blue</span><span class="err">’</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Figure 19: The annual storm count for all months (black) is plotted using ‘plot.trajectory’. A storm count for the winter season (DJF, blue) is then obtained by ‘count.trajectory’ and
added to the figure.</p>

<p>Example 4.6. # Sample trajectory object</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">(</span><span class="n">imilast.M03</span><span class="p">)</span><span class="w">
</span><span class="c1">#Map storm trajectories for the winter season (djf)</span><span class="w">
</span><span class="n">map</span><span class="p">(</span><span class="n">imilast.M03</span><span class="p">,</span><span class="n">it</span><span class="o">=</span><span class="err">’</span><span class="n">djf</span><span class="err">’</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="err">’</span><span class="n">sphere</span><span class="err">’</span><span class="p">)</span><span class="w">
</span><span class="c1"># Map number density of storms (per year and 1000km2)</span><span class="w">
</span><span class="n">map.density.trajectory</span><span class="p">(</span><span class="n">imilast.M03</span><span class="p">,</span><span class="n">it</span><span class="o">=</span><span class="err">’</span><span class="n">djf</span><span class="err">’</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-90</span><span class="p">,</span><span class="m">60</span><span class="p">),</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="m">90</span><span class="p">),</span><span class="n">dx</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="n">dy</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Figure 20:
Maps of storm trajectories in the North Atlantic region created with ‘map.trajectory’ (left) and ‘map.density.trajectory’ (right).</p>

<p>Example 4.7.</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Sample trajectory object</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">imilast.M03</span><span class="p">)</span><span class="w">
</span><span class="c1"># Perform PCA of storm tracks</span><span class="w">
</span><span class="n">pca</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">PCA.trajectory</span><span class="p">(</span><span class="n">imilast.M03</span><span class="p">,</span><span class="n">anomaly</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1"># Plot PCA</span><span class="w">
</span><span class="n">plot.pca.trajectory</span><span class="p">(</span><span class="n">pca</span><span class="p">)</span><span class="w">
</span><span class="c1"># Show PCA on map</span><span class="w">
</span><span class="n">map.pca.trajectory</span><span class="p">(</span><span class="n">pca</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Figure 21: Plot of the first (red) and second (blue) principal component obtained by PCA of storm tracks in the North Atlantic region (a). In the map (b), the solid and dashed lines
represent the maximum extent of the component in the positive and negative direction, respectively. The pca figures are produced with the functions ‘plot.pca.trajectory’ (a) and
‘map.pca.trajectory’ (b).</p>
