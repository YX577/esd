<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Trouble Shooting - esd</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Trouble Shooting | esd</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Trouble Shooting" /> <meta name="author" content="No One" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="ESD …" /> <meta property="og:description" content="ESD …" /> <link rel="canonical" href="http://localhost:4000/%5Ctrouble%5C" /> <meta property="og:url" content="http://localhost:4000/%5Ctrouble%5C" /> <meta property="og:site_name" content="esd" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"Trouble Shooting","url":"http://localhost:4000/%5Ctrouble%5C","author":{"@type":"Person","name":"No One"},"description":"ESD …","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> esd </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">esd R tool</a></li><li class="nav-list-item"><a href="http://localhost:4000/about/" class="nav-list-link">Background</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/functions/" class="nav-list-link">Utilities</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/_pages/retrieve/" class="nav-list-link">Retrieve</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/process/" class="nav-list-link">Processing I/O</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="http://localhost:4000/analyses/" class="nav-list-link">Analyses I/O</a></li><li class="nav-list-item"><a href="http://localhost:4000/downscale/" class="nav-list-link">Downscaling</a></li><li class="nav-list-item"><a href="http://localhost:4000/evaluate/" class="nav-list-link">Evaluation</a></li><li class="nav-list-item active"><a href="http://localhost:4000/%5Ctrouble%5C" class="nav-list-link active">Trouble Shooting</a></li><li class="nav-list-item"><a href="http://localhost:4000/examples/" class="nav-list-link">Examples</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search esd" aria-label="Search esd" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/metno/esd" class="site-button" > esd on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 id="trouble-shooting"> <a href="#trouble-shooting" class="anchor-heading" aria-labelledby="trouble-shooting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Trouble shooting </h1> <p>The ‘esd’ comes as it is and there is no guarantee that it’s free from bugs or incorrect coding. The user therefore must make sure that the functions work as expected through thorough testing. Any tool like this should never be used blindly. Neither is there any guarantee that the code will work flawlessly. The open-source nature, however, means that the problems can be diagnosed or fixed by anyone with insight and programming skills. Here we try to make potential trouble shooting easier.</p> <h2 id="general"> <a href="#general" class="anchor-heading" aria-labelledby="general"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> General </h2> <p>In case of error messages, it may be wise to check all the attributes of the data object. The way to proceed is to activate the ‘verbose’ argument if it is included in the function options, and repeat the analysis with the sample data provided by ‘esd’. The objects can be assigned new attributes through the ‘attr’ command. Alternatively, the source code of the function can be modified locally, by typing the name of the function without ‘()’ and copied into a local file (Example 7.1). The code in the local file can then be modified and when it is called override the original ‘esd’ version.</p> <p>Example 7.1.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get the source code in ’myeof.R’ R script file</span><span class="w">
</span><span class="n">dput</span><span class="p">(</span><span class="n">EOF.default</span><span class="p">,</span><span class="n">file</span><span class="o">=</span><span class="s2">"myeof.R"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Modify this code, but keep the same function name by adding ’EOF.default’ at the top of</span><span class="w">
</span><span class="c1"># the file.</span><span class="w">
</span><span class="c1"># Source the new code as</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"myeof.R"</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="n">environment</span><span class="p">())</span><span class="w">
</span><span class="c1"># now the call "EOF()" will use the modified version.</span><span class="w">
</span></code></pre></div></div> <p>Debugging can be done by inserting ‘browser()’ inside the function code.</p> <h2 id="functions-annual-and-aggregate"> <a href="#functions-annual-and-aggregate" class="anchor-heading" aria-labelledby="functions-annual-and-aggregate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Functions ‘annual’ and ‘aggregate’ </h2> <p>Missing data (‘NA’) can be a problem in the analysis and the downscaling of local temperature and precipitation. One example of an error is:</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">annual</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">Error</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">aggregate.data.frame</span><span class="p">(</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w">
</span><span class="n">no</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">aggregate</span><span class="w">
</span></code></pre></div></div> <p>However, if the number of missing data is small compared to the sample size, they may not have a large effect on the calibration of downscaling models or the aggregated statistics. For the temperature, a fix can be to use interpolation to fill in the missing values as in Example 7.2. For daily precipitation, a better option can be to replace missing data with zero.</p> <p>Example 7.2.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Retrieve 2m air temperature at Ferder Fyr weather station</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">ferder</span><span class="p">)</span><span class="w">
</span><span class="c1"># Extract the coredata</span><span class="w">
</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">coredata</span><span class="p">(</span><span class="n">ferder</span><span class="p">)</span><span class="w">
</span><span class="c1"># identify the missing days in the record</span><span class="w">
</span><span class="n">md</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">ferder</span><span class="p">)</span><span class="w">
</span><span class="c1"># Compute the climatology</span><span class="w">
</span><span class="n">clim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.climatology</span><span class="p">(</span><span class="n">ferder</span><span class="p">)</span><span class="w">
</span><span class="c1"># Replace the missing values with the climatology as approximations</span><span class="w">
</span><span class="n">ferder</span><span class="p">[</span><span class="n">md</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">coredata</span><span class="p">(</span><span class="n">clim</span><span class="p">)[</span><span class="n">as.POSIXlt</span><span class="p">(</span><span class="n">index</span><span class="p">(</span><span class="n">ferder</span><span class="p">)[</span><span class="n">md</span><span class="p">])</span><span class="o">$</span><span class="n">yday</span><span class="m">+1</span><span class="p">]</span><span class="w">
</span><span class="c1"># Note that as.POSIXlt()$yday function returns the day in the year</span><span class="w">
</span></code></pre></div></div> <h2 id="dsensemble"> <a href="#dsensemble" class="anchor-heading" aria-labelledby="dsensemble"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DSensemble </h2> <p>The method ‘DSensemble’ uses ‘try’ to avoid that the process stops due to errors when looping through the ensemble of GCM results. However, it cannot recover from errors in For- tran or C-based external modules, such as those based on external libraries. For instance, the following errors have been encountered: Error in La.svd(x, nu, nv) : error code 1 from Lapack routine ’dgesdd’ and/or Error in x[rep(1:NROW(x), length.out = length(index)), , drop = FALSE] : subscript out of bounds The problem is that the data matrix to which an SVD is applied is close to singular. One work-around fix is to use a different domain selection (e.g. set ‘lon’ and ‘lat’ arguments to new values). Another way to get around this problem is to use the argument ‘select’ to skip a particular model with the problem.</p> <h3 id="poor-fit"> <a href="#poor-fit" class="anchor-heading" aria-labelledby="poor-fit"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Poor fit </h3> <p>Sometimes a sub-selection of the predictand can improve the calibration of the downscaling model, especially if part of the data (older) has a lower quality than more recent measurements. One way to examine the data for quality can be to plot the time series of the annual wet-day mean and frequency for precipitation.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">annual</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">FUN</span><span class="o">=</span><span class="err">’</span><span class="n">wetfreq</span><span class="err">’</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">annual</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">FUN</span><span class="o">=</span><span class="err">’</span><span class="n">wetmean</span><span class="err">’</span><span class="p">))</span><span class="w">
</span></code></pre></div></div> <h3 id="other-error-messages"> <a href="#other-error-messages" class="anchor-heading" aria-labelledby="other-error-messages"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Other error messages </h3> <p>There may occasionally be problems associated with different types of time stamps, e.g. when combining daily, monthly, seasonal, or annual data. The time index for annual data is a numeric</p> <ul> <li>the year, and some of the methods handling the date may fail for annual data. E.g: Error in prettyNum(.Internal(format(x, trim, digits, nsmall, width, 3L,: invalid ’trim’ argument</li> </ul> <p>A couple of solutions are:</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">index</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="n">year</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="err">’</span><span class="m">01-01</span><span class="err">’</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="err">’</span><span class="o">-</span><span class="err">’</span><span class="p">))</span><span class="w">
</span><span class="c1">## or</span><span class="w">
</span><span class="n">index</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <h2 id="validate"> <a href="#validate" class="anchor-heading" aria-labelledby="validate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Validate </h2> <p>The ‘esd’ package also has a method ‘validate’ which provides a simple test statistics describing how well the results match the expectations. The null hypothesis depends on the type of object.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
